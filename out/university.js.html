<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: university.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: university.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable camelcase */
const db = require("../models/index");
const { Op } = require("sequelize")
const { university_data } = db;
const query = require("../helpers/query");

/**
 * This functions perfroms a query search of all universiities in the database.
 * it can be accepts some queries futher explained in the code.
*/
/** 
 * This function requires the modules  [Query helper] {@link module:../helpers/query} - This contains possible query parameters
 * {@link module:../helpers/query}.
 * @param {*} req 
 * @param {*} res 
 * @requires queyr [queryhelper] {@link module:../helpers/query}
 * @returns {200} - status code 200 if available
 * @returns {Promise} - promise contains json data of documents from the database
 * @returns {error} - if error occurse
 * 
 */
exports.allUniversity = async (req, res) => {
  /**
   * The amount of university needed to be returned, it comes in as a query parameter..
   * @name limit
   */
  const { limit } = req.query;
  if (!req.user || req.user === undefined) {
    return res.status(401).json({ response: "you dont have access to this endpoint" });
  }

  /**
   * @name query_filter - all qeury parameters like
   * @name region - filters result to a specific region
   * @name type - filter result to a specifuc types e.g private, public
   */
  const dbQuery = query(req.query);

  try {
    let response;
    /**
     *check for all the query parameter here and run each one by one 
     */
    if (req.query) {
      response = await university_data.findAll({
        limit,
        attributes: {
          
          exclude: ["createdAt", "updatedAt"]
        },
        
        where: dbQuery
      });
    } else {
      response = await university_data.findAll({ limit, attributes: { exclude: ["createdAt", "updatedAt"] } });
    }
    return res.status(200).json({ length: response.length, response: response });
  } catch (error) {
    return res.status(500).json({ response: `internal server error ${error}` })

  }

};


exports.oneUniversity = async (req, res) => {
  const name = req.params.name;
  const capitalize = name.toUpperCase();
  console.log(capitalize);
  try {

    if (!req.user || req.user === undefined) {
      return res.status(401).json({ response: "you dont have access to this endpoint" });
    }

    const response = await university_data.findOne({
      attributes: { exclude: ["createdAt", "updatedAt"] },
      where: {
        Abbrevation: capitalize
      }
    })
    if (response == null || response.length &lt; 1) {
      return res.status(404).json({ response: "data not found, probably we dont have the requested university data" })
    }
    return res.status(200).json({ response });
  } catch (error) {
    return res.status(500).json({ response: `${error} occured` });
  }


}

exports.updateUniversity = async (req, res) => {
  const id = req.params.id;
  if (!req.user || req.user === undefined) {
    return res.status(401).json({ response: "you dont have access to this endpoint" });
  }
  try {
    const response = await university_data.findOne({
      attributes: { exclude: ["createdAt", "updatedAt"] },
      where: {
        id: id
      }
    });
    if (!response || response === null) return res.status(404).json({ response: "We couldnt find the university, it has been deleted or moved" })
    const update = await university_data.update(
      {
        Name: req.body.Name,
        State: req.body.State,
        Location: req.body.Location,
        Type: req.body.Type,
        Founded: req.body.Founded,
        URl: req.body.URl,
        Social_media_handle_URL: req.body.Social_media_handle_URL,
        Motto: req.body.Motto,
        Abbrevation: req.body.Abbrevation,
        Academic_Calendar: req.body.Academic_Calendar,
        Academic_Staff: req.body.Academic_Staff,
        Accreditations: req.body.Accreditations,
        Admission_Rate: req.body.Admission_Rate,
        Campus_Setting: req.body.Campus_Setting,
        Colours: req.body.Colours,
        Distance_Learning: req.body.Distance_Learning,
        Entity_Type: req.body.Entity_Type,
        Faculty_or_Colleges: req.body.Faculty_or_Colleges,
        Financial_Aids: req.body.Financial_Aids,
        Gender: req.body.Gender,
        Housing: req.body.Housing,
        International_Students: req.body.International_Students,
        Library: req.body.Library,
        Number_of_Students: req.body.Number_of_Students,
        Number_of_Faculties: req.body.Number_of_Faculties,
        Programme_Offered: req.body.Programme_Offered,
        Region: req.body.Region,
        Selection_Type: req.body.Selection_Type,
        Sport_Facilities: req.body.Sport_Facilities,
        Study_Abroad: req.body.Study_Abroad,
        University_Overview: req.body.University_Overview,
        Wikipedia_Article: req.body.Wikipedia_Article,
        Memberships_and_Affiliations: req.body.Members_and_Affiliations,
        Religious_Affiliation: req.body.Religious_Affiliation

      },
      {
        where: { id: id },
        returning: true
      },
    )
    console.log(update)
    return res.status(200).json({
      response: "data updated successfully",
      update
    })
  } catch (error) {
    return res.status(500).json({ response: `${error} occured` });
  }
}

exports.postUniversity = async (req, res) => {
  if (!req.user || req.user === undefined) {
    return res.status(401).json({ response: "you dont have access to this endpoint" });
  }
  try {
    const payload = {
      Name: req.body.Name,
      State: req.body.State,
      Location: req.body.Location,
      Type: req.body.Type,
      Founded: req.body.Founded,
      URl: req.body.URl,
      Social_media_handle_URL: req.body.Social_media_handle_URL,
      Motto: req.body.Motto,
      Abbrevation: req.body.Abbrevation,
      Academic_Calendar: req.body.Academic_Calendar,
      Academic_Staff: req.body.Academic_Staff,
      Accreditations: req.body.Accreditations,
      Admission_Rate: req.body.Admission_Rate,
      Campus_Setting: req.body.Campus_Setting,
      Colours: req.body.Colours,
      Distance_Learning: req.body.Distance_Learning,
      Entity_Type: req.body.Entity_Type,
      Faculty_or_Colleges: req.body.Faculty_or_Colleges,
      Financial_Aids: req.body.Financial_Aids,
      Gender: req.body.Gender,
      Housing: req.body.Housing,
      International_Students: req.body.International_Students,
      Library: req.body.Library,
      Number_of_Students: req.body.Number_of_Students,
      Number_of_Faculties: req.body.Number_of_Faculties,
      Programme_Offered: req.body.Programme_Offered,
      Region: req.body.Region,
      Selection_Type: req.body.Selection_Type,
      Sport_Facilities: req.body.Sport_Facilities,
      Study_Abroad: req.body.Study_Abroad,
      University_Overview: req.body.University_Overview,
      Wikipedia_Article: req.body.Wikipedia_Article,
      Memberships_and_Affiliations: req.body.Memberships_and_Affiliations,
      Religious_Affiliation: req.body.Religious_Affiliation
    };

    const createUni = await university_data.create(payload);
    if (createUni) {
      return res.status(201).json({ response: "New university Data saved", createUni });
    }
    return res.status(403).json({ response: "Unable to save university data, please try again" });

  } catch (error) {
    return res.status(500).json({ response: `${error} occured` })
  }
}

exports.deleteUniversity = async (req, res) => {
  const id = req.params.id;
  if (!req.user || req.user === undefined) {
    return res.status(401).json({ response: "you dont have access to this endpoint" });
  }
  try {
    const deleteDoc = await university_data.destroy({ where: { id: id } });
    if (deleteDoc) return res.status(200).json({ response: "university deleted", count: deleteDoc });
    return res.status(204).json({ response: "It looks like this data no longer exist or has been moved" });

  } catch (error) {
    return res.status(500).json({ response: `${error} occured` })
  }
}

exports.getAllUniversity = async (req, res) => {
  const { limit } = req.query;
  if (!req.user || req.user === undefined) {
    return res.status(401).json({ response: "you dont have access to this endpoint" });
  }

  const dbQuery = query(req.query);

  try {
    let response;
    // check for all the query parameter here and run each one by one
    if (req.query) {
      response = await university_data.findAll({
        limit,
        attributes: {
          exclude: ["createdAt", "updatedAt"]
        },
        where: dbQuery
      });
    } else {
      response = await university_data.findAll({ limit, attributes: { exclude: ["createdAt", "updatedAt"] } });
    }
    return res.status(200).json({ length: response.length, response: response });
  } catch (error) {
    return res.status(500).json({ response: `internal server error ${error}` })

  }

};

exports.getOneUni = async (req, res) => {
  const id  = req.params.id;
  try {

    if (!req.user || req.user === undefined) {
      return res.status(401).json({ response: "you dont have access to this endpoint" });
    }

    const response = await university_data.findOne({
      attributes: { exclude: ["createdAt", "updatedAt"] },
      where: {
        id: id
      }
    })
    console.log(response);
    if (response == null || response.length &lt; 1) {
      return res.status(404).json({ response: "data not found, probably we dont have the requested university data" })
    }
    return res.status(200).json({ response });
  } catch (error) {
    return res.status(500).json({ response: `${error} occured` });
  }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#allUniversity">allUniversity</a></li><li><a href="global.html#limit">limit</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sat Nov 07 2020 17:27:56 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
